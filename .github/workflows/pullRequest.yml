name: testing

on:
  pull_request:
    branches:
        - main
    workflow_dispatch:

jobs:
    test:
        runs-on: macos-11
        steps:
          - name: Checkout
            uses: actions/checkout@v3
        
          - name: Cancel Previous Runs
            uses: styfle/cancel-workflow-action@0.11.0
            with:
              access_token: ${{ github.token }}
              
          - name: installed versions of Xcode
            uses: maxim-lobanov/setup-xcode@v1
            with:
              xcode-version: latest-stable
         
          - uses: ruby/setup-ruby@v1
            with:
              ruby-version: '3.0'
              bundler-cache: true

          - name: Install Bundler
            run: gem install bundler
            
          - name: Install gems
            run: bundle install
            
            - name: Swift Packages Cache
                uses: actions/cache@v2
                id: cache
                with:
                  path: |
                    Build/SourcePackages
                    Build/Build/Products
                  key: ${{ runner.os }}-deps-v1-${{ hashFiles('BILDsolid.xcodeproj/project.xcworkspace/xcshareddata/swiftpm/Package.resolved') }}
                  restore-keys: ${{ runner.os }}-deps-v1-
